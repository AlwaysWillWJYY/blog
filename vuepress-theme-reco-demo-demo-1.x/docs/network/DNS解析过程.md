### DNS解析过程

![在这里插入图片描述](https://img-blog.csdnimg.cn/74cac88facd1489aaa7cc8ba0b1be5c6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbGVlZGNvZGVKb2huMDE=,size_19,color_FFFFFF,t_70,g_se,x_16)

**根域名服务器: 最高层次的域名服务器，也是最重要的域名服务器**。所有的根域名服务器都知道所有的顶级域名服务器的域名和`IP`地址。不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先求助根域名服务器。所以根域名服务器是最重要的域名服务器。假定所有的根域名服务器都瘫痪了，那么整个`DNS`系统就无法工作。需要注意的是，**在很多情况下，根域名服务器并不直接把待查询的域名直接解析出`IP`地址，而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进查询**。

全球一共有13台根域名服务器，其中10台分布在美国，剩余三台在英国，瑞典和日本。

顶级域名服务器：负责管理在该顶级域名服务器注册的二级域名。

权限域名服务器：负责一个“区”的域名服务器。

本地域名服务器：本地服务器不属于下图的域名服务器的层次结构，但是它对域名系统非常重要。当一个主机发出`DNS`查询请求时，这个查询请求报文就发送给本地域名服务器。

**域名解析过程**

那么我们的`DNS`是怎么解析一个域名的呢？

1.现在我有一台计算机，通过`ISP`接入了互联网，那么`ISP`就会给我分配一个`DNS`服务器，这个`DNS`服务器不是权威服务器，而是相当于一个代理的`dns`解析服务器，他会帮你迭代权威服务器返回的应答，然后把最终查到`IP`返回给你。

2.现在的我计算机要向这台`ISPDNS`发起请求查询`www.baidu.com`这个域名了，(经网友提醒：这里其实准确来说不是`ISPDNS`，而应该是用户自己电脑网络设置里的`DNS`，并不一定是`ISPDNS`。比如也有可能你手工设置了`8.8.8.8`)

3.`ISPDNS`拿到请求后，先检查一下自己的缓存中有没有这个地址，有的话就直接返回。这个时候拿到的`ip`地址，会被标记为非权威服务器的应答。

4.如果缓存中没有的话，`ISPDNS`会从配置文件里面读取13个根域名服务器的地址（这些地址是不变的，直接在`BIND`的配置文件中），

5.然后向其中一台发起请求。

6.根服务器拿到这个请求后，知道他是`com.`这个顶级域名下的，所以就会返回`com`域中的`DNS`记录，一般来说是13台主机名和`IP`。

7.然后`ISPDNS`向其中一台再次发起请求，`com`域的服务器发现你这请求是`baidu.com`这个域的，我一查发现了这个域的DNS，那我就返回给你，你再去查。
（目前百度有4台baidu.com的顶级域名服务器）。

8.ISPDNS不厌其烦的再次向baidu.com这个域的权威服务器发起请求，baidu.com收到之后，查了下有www的这台主机，就把这个IP返回给你了，


9.然后`ISPDNS`拿到了之后，将其返回给了客户端，并且把这个保存在高速缓存中。

一、 **主机向本地域名服务器的查询一般都是采用递归查询**

所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的`IP`地址，那么本地域名服务器就以`DNS`客户的身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。

因此，递归查询返回的查询结果或者是所要查询的`IP`地址，或者是报错，表示无法查询到所需的`IP`地址

二、 **本地域名服务器向根域名服务器的查询的迭代查询**

迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的`IP`地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。

然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的`IP`地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。

顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的`IP`地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。


